---
- hosts: all 
  tasks:
  - name: Collecting Health Information of Metron nodes
    copy:  
      dest: /home/devopsuser/Health/{{ansible_hostname}}_{{ansible_date_time.date}}_{{ansible_date_time.time}}.txt 
      content: "\n\n{{ansible_hostname}}_{{ansible_date_time.date}}_{{ansible_date_time.time}}\n\n#####################################################################\n\n\tDATE: {{ansible_date_time.date}}\n\tTIME: {{ansible_date_time.time}}\n\n#####################################################################\n\n\tHOSTNAME: {{ansible_hostname}}\n\tMACHINE: {{ansible_machine}}\n\n#####################################################################\n\n\tOS_FAMILY: {{ansible_os_family}}\n\tOPERATING_SYSTEM: {{ansible_distribution}}\n\tOPERATING_SYSTEM_VERSION: {{ansible_distribution_major_version}}\n\tKERNEL_VERSION: {{ansible_kernel}}\n\n#####################################################################\n\n\tPROCESSOR: {{ansible_processor[1]}}\n\tNO_OF_CORES: {{ansible_processor_cores}}\n\n#####################################################################\n\n\tIPADDRESS: {{ansible_default_ipv4.address}}\n\tMACADDRESS: {{ansible_default_ipv4.macaddress}}\n\n#####################################################################\n\n\tTOTAL_RAM: {{ansible_memtotal_mb}} MB\n\tFREE_RAM: {{ansible_memfree_mb}} MB\n\tUSED_MEMORY: {{ansible_memory_mb.real.used}} MB\n#####################################################################\n\n\t{% for n in ansible_mounts %} \tDEVICE: {{ n['device'] }} \n\tFILESYSTEM_TYPE: {{ n['fstype'] }}\n\tTOTAL_SIZE: {{ n['size_total'] }} MB\n\tAVAILABLE_SIZE: {{ n['size_available'] }} MB\n ------------------------------------------------------------------\n{% endfor %}\n#####################################################################"
    delegate_to:  172.25.1.20
  - slack:
      token:  T5P0QEGFQ/B6H0FG96U/yKczessxOtbB31VGv2VWkncE 
      domain: https://prodevans-forge.slack.com
#      msg:  "https://192.168.1.201/facts/{{ansible_hostname}}_{{ansible_date_time.date}}_{{ansible_date_time.time}}.txt"
      msg:  "\n\n{{ansible_hostname}}_{{ansible_date_time.date}}_{{ansible_date_time.time}}\n\n#####################################################################\n\n\tDATE: {{ansible_date_time.date}}\n\tTIME: {{ansible_date_time.time}}\n\n#####################################################################\n\n\tHOSTNAME: {{ansible_hostname}}\n\tMACHINE: {{ansible_machine}}\n\n#####################################################################\n\n\tOS_FAMILY: {{ansible_os_family}}\n\tOPERATING_SYSTEM: {{ansible_distribution}}\n\tOPERATING_SYSTEM_VERSION: {{ansible_distribution_major_version}}\n\tKERNEL_VERSION: {{ansible_kernel}}\n\n#####################################################################\n\n\tPROCESSOR: {{ansible_processor[1]}}\n\tNO_OF_CORES: {{ansible_processor_cores}}\n\n#####################################################################\n\n\tIPADDRESS: {{ansible_default_ipv4.address}}\n\tMACADDRESS: {{ansible_default_ipv4.macaddress}}\n\n#####################################################################\n\n\tTOTAL_RAM: {{ansible_memtotal_mb}} MB\n\tFREE_RAM: {{ansible_memfree_mb}} MB\n\tUSED_MEMORY: {{ansible_memory_mb.real.used}} MB\n#####################################################################\n\n\t{% for n in ansible_mounts %} \tDEVICE: {{ n['device'] }} \n\tFILESYSTEM_TYPE: {{ n['fstype'] }}\n\tTOTAL_SIZE: {{ n['size_total'] }} MB\n\tAVAILABLE_SIZE: {{ n['size_available'] }} MB\n ------------------------------------------------------------------\n{% endfor %}\n#####################################################################"
    delegate_to:  172.25.1.20
    
